<html>
<head>
  <style>
    html {height:100%; width:100%; margin: 0; padding: 0;}
    body {height:100%; width:100%; margin: 0; padding: 0; display: flex; justify-content: center; align-items: center;}
  </style>
  
  </head>
<body>
<style type="text/css" scoped>
  #mauticform_unsubscribe_message, #mauticform_unsubscribe_email{
    visibility: hidden;
  }
  
  #mauticform_input_unsubscribe_submit, #mauticform_input_unsubscribe_dont{
    float: left;
    width: 50%;
  }
</style>
  <div id="mauticform_wrapper_unsubscribe" class="mauticform_wrapper">
  <form autocomplete="false" role="form" method="post" action="https://olivera.mautic.net/form/submit?formId=1" id="mauticform_unsubscribe"  data-mautic-form="unsubscribe" enctype="multipart/form-data">
      <div class="mauticform-error" id="mauticform_unsubscribe_error"></div>
      <div class="mauticform-message" id="mauticform_unsubscribe_message"></div>
      <div class="mauticform-innerform">


        <div class="mauticform-page-wrapper mauticform-page-1" data-mautic-form-page="1">

          <div id="mauticform_unsubscribe_email"  data-validate="email" data-validation-type="email" class="mauticform-row mauticform-email mauticform-field-1 mauticform-required">
              <label id="mauticform_label_unsubscribe_email" for="mauticform_input_unsubscribe_email" class="mauticform-label">Email</label>
              <input id="mauticform_input_unsubscribe_email" name="mauticform[email]" value="" placeholder="Email" class="mauticform-input" type="email" />
              <span class="mauticform-errormsg" style="display: none;">Email is required</span>
          </div>
          <h2>Are you sure you wish to unsubscribe from our mailing list</h2>
          <div id="mauticform_unsubscribe_submit"  class="mauticform-row mauticform-button-wrapper mauticform-field-2">
              <button type="submit" name="mauticform[submit]" id="mauticform_input_unsubscribe_submit" name="mauticform[submit]" value="" class="mauticform-button btn btn-default" value="1">Yes</button>
          </div>
          <div class="mauticform-row mauticform-button-wrapper mauticform-field-2">
              <button id="mauticform_input_unsubscribe_dont" class="mauticform-button btn btn-default">No</button>
          </div>
          </div>
      </div>

      <input type="hidden" name="mauticform[formId]" id="mauticform_unsubscribe_id" value="1"/>
      <input type="hidden" name="mauticform[return]" id="mauticform_unsubscribe_return" value=""/>
      <input type="hidden" name="mauticform[formName]" id="mauticform_unsubscribe_name" value="unsubscribe"/>

  </form>
  </div>
</div>
  <script type="text/javascript">
      /* This section is only needed once per page if manually copying */
      if (typeof MauticSDKLoaded == 'undefined') {
          var MauticSDKLoaded = true;
          var head            = document.getElementsByTagName('head')[0];
          var script          = document.createElement('script');
          script.type         = 'text/javascript';
          script.src          = 'https://olivera.mautic.net/mautic/media/js/mautic-form.js';
          script.onload       = function() {
              MauticSDK.onLoad();
          };
          head.appendChild(script);
          var MauticDomain = 'https://olivera.mautic.net';
          var MauticLang   = {
              'submittingMessage': "Please wait..."
          }
      }
  </script>
  <script>
    var url = window.location.href.substring(window.location.href.indexOf('?')+1, window.location.href.length);
    var objectUrl = urlToObject(url)
    
    var inputEmail = document.querySelector('#mauticform_input_unsubscribe_email');
    var buttSubscribe = document.querySelector('#mauticform_input_unsubscribe_submit');
    var buttDont = document.querySelector('#mauticform_input_unsubscribe_dont');
    
    if(window.location.href.indexOf('?') > 0){
      inputEmail.value = objectUrl.email;
      buttSubscribe.addEventListener("click", (e) => {
        var promiseUnsubscribe = new Promise(function(resolve, reject) {
          window.open(window.location.href, '_self', '');
          setTimeout(resolve, 5000, 'done');
        });
        promiseUnsubscribe.then((r) => {
          window.close();
        });
      });
      buttDont.addEventListener("click", (e) => {
        var promiseDont = new Promise(function(resolve, reject) {
          window.open(window.location.href, '_self', '');
          setTimeout(resolve, 5000, 'done');
        });
        promiseDont.then((r) => {
          window.close();
        });
      });
    }
    
    console.log(objectUrl)
    
    function urlToObject(url) {
      var hash;
      var myJson = {};
      var hashes = url.slice(url.indexOf('?') + 1).split('&');
      for (var i = 0; i < hashes.length; i++) {
          hash = hashes[i].split('=');
          myJson[hash[0]] = hash[1];
      }
        return myJson;
    }
  </script>
</body>
</html>
